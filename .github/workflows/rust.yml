name: CI

on:
  push:
    branches: ["dev", "dev_ci", "dev_icy"]
  pull_request:
    branches: ["dev", "dev_ci"]

env:
  CARGO_TERM_COLOR: always
  redis: localhost:56810
  redis_with_slave: localhost:56812
  counterservice: localhost:9302
  mc: localhost:9301
  phantom: localhost:9303
  min_key: 1
  max_key: 10000
  socks_dir: /home/runner/work/breeze/socks

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Mysql start and init
        run: |
          docker run --rm --name breeze_ci_mysql4623  -p 4623:3306 -d viciousstar/mysqlci_with_schema
          docker run --rm --name breeze_ci_mysql4624  -p 4624:3306 -d viciousstar/mysqlci_with_schema
          sleep 10
          ss -an | grep 462
          docker run --net="host" --rm mysql mysql -h127.0.0.1 -P4623 -umesh -pLgv6zhwHar8Flx0b -e "select * from status_0.status_210101;"
